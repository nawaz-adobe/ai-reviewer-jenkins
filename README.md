# AI Code Reviewer - Jenkins Integration

> **Automate intelligent code reviews in your Jenkins CI/CD pipeline using OpenAI**

Add AI-powered code analysis to any Jenkins pipeline. Get detailed feedback on pull requests, security issues, and code quality automatically.

## ✨ Features

- 🤖 **AI-Powered Reviews** - OpenAI analyzes your code changes
- 💬 **GitHub Integration** - Posts comments directly to PRs  
- 🔒 **Security Focused** - Input validation and safe API calls  
- 📊 **JSON Output** - Structured results for easy processing
- ⚡ **Ultra Fast** - Uses GitHub API directly, no repository cloning
- 🔧 **Easy Integration** - Just 3 arguments: org, repo, PR number
- 📝 **Detailed Reports** - Code quality, security, and improvement suggestions

## 🎯 Use Cases

- **Pull Request Reviews** - Automated feedback before merging
- **Security Scanning** - Identify potential vulnerabilities  
- **Code Quality Gates** - Enforce standards in CI/CD
- **Developer Education** - Learn from AI suggestions
- **Legacy Code Analysis** - Understand and improve existing code

## 🚀 Quick Start

### Prerequisites
Before starting, ensure you have:
- **Node.js 18+** installed (`node --version`)
- **npm** or **yarn** package manager
- **Git** for repository operations

### 1. Build Job Package
```bash
npm install
npm run build                    # Generates dist/ai-review-job/
```

### 2. Deploy Package
```bash
# Deploy this package to your Jenkins nodes:
dist/ai-review-job/             # ← Simple job execution package
```

### 3. Usage

#### Direct Usage:
```bash
./ai-review myorg myrepo 123
```

#### Jenkins Pipeline
```groovy
pipeline {
    agent any
    environment {
        LLM_API_KEY = credentials('llm-api-key')
        LLM_ENDPOINT = credentials('llm-endpoint')
        GITHUB_TOKEN = credentials('github-token')
        GITHUB_BASE_URL = credentials('github-base-url')  // For enterprise GitHub
        POST_COMMENTS = 'true'  // Posts AI comments directly to PR
    }
    stages {
        stage('AI Code Review') {
            steps {
                sh '''
                    /path/to/ai-review-job/ai-review \
                        "${ORG_NAME}" "${REPO_NAME}" "${PR_NUMBER}" \
                        "review-results.json"
                '''
                
                // Archive results for Jenkins
                archiveArtifacts artifacts: 'review-results.json', fingerprint: true
            }
        }
    }
}
```

## 📦 What Gets Built

| Package | Location | Size | Purpose |
|---------|----------|------|---------|
| **Job Package** | `dist/ai-review-job/` | ~5KB | Single executable file |

**Ultra-simple:** One self-contained executable, uses GitHub API directly!

### Package Contents:
- `ai-review` - Single executable script (everything included)

## 💬 GitHub Integration

The tool automatically posts AI review feedback directly to your GitHub PR:

### Summary Comment (PR-level):
```markdown
## 🤖 AI Code Review Summary

Overall, this PR introduces a new authentication feature with good security practices. 
Key observations:
- ✅ Proper input validation implemented
- ⚠️  Consider adding rate limiting for login attempts
- 🔒 Secrets are handled securely

---
*Generated by AI Code Reviewer*
```

### Line-specific Comments:
- **File**: `src/auth.js`, **Line**: 45
- **Comment**: 🤖 **AI Review:** Consider using bcrypt with a higher cost factor (12+) for better security.

### Environment Control:
```bash
POST_COMMENTS=true   # Posts comments to PR (default)
POST_COMMENTS=false  # Only generates JSON file, no PR comments
```

## 🔧 Jenkins Node Setup

### 1. Install Node.js (Required)
Each Jenkins node needs Node.js 18+ installed:

#### Ubuntu/Debian:
```bash
# Install Node.js 18 LTS
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# Verify installation
node --version    # Should show v18.x.x or higher
npm --version
```

#### RHEL/CentOS/Amazon Linux:
```bash
# Install Node.js 18 LTS  
curl -fsSL https://rpm.nodesource.com/setup_18.x | sudo bash -
sudo yum install -y nodejs

# Verify installation
node --version    # Should show v18.x.x or higher
npm --version
```

#### Docker Jenkins:
```dockerfile
# Add to your Jenkins Dockerfile
RUN curl -fsSL https://deb.nodesource.com/setup_18.x | bash - \
    && apt-get install -y nodejs
```

### 2. Install AI Reviewer Dependencies
```bash
# Install required npm packages globally
npm install -g ai-reviewer-core commander dotenv

# OR install in Jenkins workspace
mkdir -p /var/jenkins_home/tools/ai-reviewer
cd /var/jenkins_home/tools/ai-reviewer
npm install ai-reviewer-core commander dotenv
```

### 3. Verify Setup
```bash
node --version    # Should be v18+
git --version     # Git is required for repository operations
npm list -g ai-reviewer-core    # Should show installed version
```

### Jenkins Configuration

#### Credentials (Jenkins → Manage → Credentials)
- **`llm-api-key`** (Secret text): Your OpenAI API key
- **`llm-endpoint`** (Secret text): `https://api.openai.com/v1/chat/completions`
- **`github-token`** (Secret text): GitHub API token with PR read/write access
  - Generate at: Settings → Developer settings → Personal access tokens
  - Required scopes: `repo` (for private repos) or `public_repo` (for public)
  - Must have permission to post comments and create PR reviews
- **`github-base-url`** (Secret text): 
  - Adobe: `https://git.corp.adobe.com/api/v3`
  - Public GitHub: `https://api.github.com` (default)

### Job Parameters
- **`ORG_NAME`**: GitHub organization 
- **`REPO_NAME`**: Repository name
- **`PR_NUMBER`**: Pull request number

## 🔒 Security Features

✅ Input validation for org/repo/PR parameters  
✅ **Octokit SDK** - Official GitHub API library with built-in security  
✅ **Token-based authentication** - Secure API access  
✅ **Enterprise GitHub support** - Works with git.corp.adobe.com  
✅ **No shell commands** - Pure JavaScript/Node.js  
✅ **No file system operations** - No repository cloning needed  

## 🏗️ Development

```bash
npm install                     # Setup
npm test                        # Run tests
npm run build                   # Build Jenkins job package
```

## 📄 License

Apache-2.0